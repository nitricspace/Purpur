From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: jmp <jasonpenilla2@me.com>
Date: Mon, 11 Jan 2021 12:43:51 -0800
Subject: [PATCH] Fix villager boat exploit


diff --git a/src/main/java/net/minecraft/server/PlayerList.java b/src/main/java/net/minecraft/server/PlayerList.java
index 70f702680f8221cb262023814a7bae21b0074da6..c64ffbe49d90db2a3bba8bf83de06a224ba6c0b9 100644
--- a/src/main/java/net/minecraft/server/PlayerList.java
+++ b/src/main/java/net/minecraft/server/PlayerList.java
@@ -540,6 +540,15 @@ public abstract class PlayerList {
 
                 for (Iterator iterator = entity.getAllPassengers().iterator(); iterator.hasNext(); entity1.dead = true) {
                     entity1 = (Entity) iterator.next();
+                    // Purpur start
+                    if (entity1 instanceof EntityVillagerAbstract) {
+                        final EntityVillagerAbstract villager = (EntityVillagerAbstract) entity1;
+                        final EntityHuman human = villager.getTrader();
+                        if (human != null) {
+                            villager.setTradingPlayer(null);
+                        }
+                    }
+                    // Purpur end
                     worldserver.removeEntity(entity1);
                 }
 
